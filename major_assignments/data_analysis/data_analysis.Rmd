---
title: "Data Analysis Project"
author: "Kassidy, Maddie, Cassidie"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load libraries

Loading required libraries for this analysis.

```{r echo=FALSE, message=FALSE}
options(scipen=999)
library(tidyverse)
library(lubridate)
library(refinr)
library(tidycensus)
install.packages("censusxy")
library(censusxy)

library(janitor)
library(sf)
library(tigris)
install.packages("usmap")
library(usmap)

census_api_key("0105753aba54d204fb6c33c44044ae59449b3773", overwrite =TRUE)


```

## Load and Cleaning Data

```{r}
# Load geocoded shootings data

fatal_shootings <- read_rds("data/all_geocoded_shootings.rds")

shootings_geoid_grouped <- fatal_shootings %>%
  group_by(census_tracts_geoid)%>%
  summarise(count=n())%>%
  rename(geoid=census_tracts_geoid)

# # Load census data
# states_dataframe <- fips_codes %>%
#   distinct(state) %>%
#   head(51) %>%
#   as_vector()

# census <- get_acs(geography = "tract", state=states_dataframe, 
#                        variables = c(popululation = "B02001_001",
#                                 median.gross.rent = "B25064_001",
#                                 median.household.income = "B19013_001",
#                                 rent.burden = "B25071_001",
#                                 white = "B03002_003", 
#                                 af.am = "B03002_004",
#                                 hispanic = "B03002_012",
#                                 am.ind = "B03002_005",
#                                 asian = "B03002_006",
#                                 nh.pi = "B03002_007",
#                                 multiple = "B03002_009",
#                                 other = "B03002_008"),
#                           year= 2019)
#write_rds(census,"census.rds")
census <- read_rds("data/census.rds")%>%
  clean_names()%>%
  select(-moe) %>%
  pivot_wider(names_from=variable, values_from=estimate) %>%
  rename(population = popululation) %>%
  mutate(percentage_black = (`af.am`/population))

glimpse(census)

shootings_census <- census %>%
  left_join(shootings_geoid_grouped) %>%
  mutate(shooting=case_when(
    is.na(count)~"No",
    TRUE~"Yes"
  ))%>%
  select(-count)



```

###Question 1:
Are Police shootings primarily only happening in majority Black neighborhoods even when the victim is not black?
###Answer 1:
Yes, it is happening more predominately in Black neighborhoods, the percentage overall in the US for the black population is 12%, and the shooting data showed it as 14% in Black areas.

```{r}

shootings_census %>%
  filter(shooting=="Yes") %>%
  summarise(total_black = sum(af.am),
           total_pop = sum(population)) %>%
  mutate(percentage_black=(total_black/total_pop))


shootings_census %>%
  summarise(total_black = sum(af.am),
           total_pop = sum(population)) %>%
  mutate(percentage_black=(total_black/total_pop))


#By Census tract

sc <- shootings_census %>%
  filter(shooting=="Yes") %>%
  filter(percentage_black >= .5) %>%
  arrange(desc(percentage_black))
  

```

### Question 2
*Do these shootings mostly occur in low income areas? 
###Answer2:
Yes, shootings are occurring more in low income areas. The mean income in the shooting data is $56,554, where the national mean income is $67,007.

```{r}
#Aggregate
shootings_income<-shootings_census%>%
  filter(!is.na(median.household.income)) %>%
  summarise(mean_income =mean(median.household.income))


census_income<-census%>%
  filter(!is.na(median.household.income)) %>%
  summarise(mean_income =mean(median.household.income))





```

### Question 3
*Are police shootings still happening disproportionately affecting black people regardless of the area (even in white neighborhoods)?
###Answer 3:
Yes, police shootings are disproportionately affecting Black people. They account for 23% of police shootings, even though they account for 12% of the country's entire population. 


```{r}
options(scipen = 999)

race_shootings <- shootings_census %>%
  filter(!is.na(race))

race_counted<-race_shootings%>%
 group_by(race)%>%
  count(race)

race<-race_counted%>%
  add_column(total="6410")

race$total <- as.numeric(race$total)

race_percent<-race%>%
   mutate(percent=(n/total))
```

### Question 4
How do these percentages compare to other states.
### Answer 4
In Illinois, the Black population accounts for about 14% of the total population, yet in 50% percent of its shootings the victim is Black. 

```{r}
#Filtering for only Black shootings
shootings_geoid_black <- shootings_census %>%
  filter(race =="B")

#Grouping Black shootings by state
shootings_geoid_black <- shootings_geoid_black %>%
  group_by(state) %>%
  summarise(count=n()) %>%
  arrange(desc(count))

#Total shootings per state
shootings_states <- shootings_census %>%
  group_by(state) %>%
  summarise(count=n()) %>%
  arrange(desc(count)) %>%
  rename(total_count=count)

#Joining by state
shootings_total <- shootings_states %>%
  left_join(shootings_geoid_black, by=c("state"))

#Find percentage
shootings_total<-shootings_total %>%
  mutate(percentage_black=(count/total_count)) %>%
  arrange(desc(percentage_black))

#Getting Census data for population by state
census_2 <- get_acs(geography = "state", 
                       variables = c(popululation = "B02001_001",
                                median.gross.rent = "B25064_001",
                                median.household.income = "B19013_001",
                                af.am = "B03002_004"),
                          year= 2019)

write_rds(census_2,"census_2.rds")
census_2 <- read_rds("census_2.rds")

census_3 <- census_2 %>%
  select(-moe) %>%
  pivot_wider(names_from=variable, values_from=estimate)

census_3 <- census_3 %>%
  mutate(total_pop_black=(af.am/popululation)) %>%
  arrange(desc(total_pop_black)) %>%
  rename(state_name=NAME)

fips_codes <- fips_codes %>%
  select(state,state_name)%>%
  distinct()

shootings_black_joined <- fips_codes %>%
  left_join(shootings_total, by=c("state"))%>%
  left_join(census_3, by=c("state_name")) %>%
  mutate(difference=(percentage_black-total_pop_black)) %>%
  arrange(desc(difference))


#Illinois

race_shootings %>%
  group_by(city)%>%
  filter(state=="IL")
  

```
-30-
